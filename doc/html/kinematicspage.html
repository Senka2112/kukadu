<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>kukadu: The kinematics module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">kukadu
   &#160;<span id="projectnumber">0.1a</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The kinematics module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="index.html#kinematics">The kinematics and Planning module</a> module provides interfaces and their implementations for path planning and kinematics (forward, inverse). It is possible to easily instantiate different versions of path planners and use the optimal planner for the desired purpose. Currently, there are 3 different planners implemented:</p>
<ul>
<li><a class="el" href="classkukadu_1_1SimplePlanner.html">kukadu::SimplePlanner</a>: This planner implements a simple interpolation in joint space in order to compute a plan from one joint position to another. In order to do so, it uses the <a href="http://www.reflexxes.ws/">Reflexxes</a> library. For Cartesian planning it simple performs inverse kinematics for the target position and interpolates in joint space. It does not support any functionality for obstacle avoidance or for fulfilling specific constraints.</li>
<li><a class="el" href="classkukadu_1_1KomoPlanner.html">kukadu::KomoPlanner</a>:</li>
<li><a class="el" href="classkukadu_1_1MoveItKinematics.html">kukadu::MoveItKinematics</a>:</li>
</ul>
<h1><a class="el" href="classkukadu_1_1KomoPlanner.html">kukadu::KomoPlanner</a></h1>
<p>The next code snippet shows, how kukadu can be used in combination with KOMO. KOMO is a robust and stable path planner and we recommend to use this planner. If you don't select a specific planner, KOMO will be used automatically.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;kukadu/kukadu.hpp&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;geometry_msgs/Pose.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>kukadu;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up ros node&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ros::init(argc, args, <span class="stringliteral">&quot;kukadu_planning&quot;</span>); ros::NodeHandle node; sleep(1);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ros::AsyncSpinner spinner(10); spinner.start();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up control queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">auto</span> realLeftQueue = make_shared&lt;KukieControlQueue&gt;(<span class="stringliteral">&quot;simulation&quot;</span>, <span class="stringliteral">&quot;left_arm&quot;</span>, node);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keyword">auto</span> komo = make_shared&lt;KomoPlanner&gt;(realLeftQueue, resolvePath(<span class="stringliteral">&quot;$KUKADU_HOME/external/komo/share/data/kuka/data/iis_robot.kvg&quot;</span>), resolvePath(<span class="stringliteral">&quot;$KUKADU_HOME/external/komo/share/data/kuka/config/MT.cfg&quot;</span>), realLeftQueue-&gt;getRobotSidePrefix());</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    realLeftQueue-&gt;setPathPlanner(komo);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    realLeftQueue-&gt;setKinematics(komo);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;starting queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keyword">auto</span> realLqThread = realLeftQueue-&gt;startQueue();</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;switching to impedance mode if it is not there yet&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span>(realLeftQueue-&gt;getCurrentMode() != KukieControlQueue::KUKA_JNT_IMP_MODE) {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        realLeftQueue-&gt;switchMode(KukieControlQueue::KUKA_JNT_IMP_MODE);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    }</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">/****** stuff is set up now --&gt; here you can move as much as you want *******/</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;joint ptp&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    realLeftQueue-&gt;jointPtp({-1.5, 1.56, 2.33, -1.74, -1.85, 1.27, 0.71});</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp without max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    geometry_msgs::Pose nextPose; nextPose.position.x = 0.3; nextPose.position.y = 1.3; nextPose.position.z = 0.6;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    nextPose.orientation.x = -0.06; nextPose.orientation.y = -0.14; nextPose.orientation.z = -0.29; nextPose.orientation.w = 0.94;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;first ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp with max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    nextPose.position.z = 0.45;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose, 10.0);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;second ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">/****** done with moving? --&gt; clean up everything and quit *******/</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    realLeftQueue-&gt;stopQueue();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    realLqThread-&gt;join();</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
</div><!-- fragment --><h2>Prerequisites</h2>
<p>The only prerequisite is the started kukie controller. Further, the environment variable <em>KUKADU_HOME</em> needs to be set to the base folder of kukadu. This variable should be set in your bash by </p>
<div class="fragment"><div class="line">export KUKADU_HOME=%INSERT_YOUR_PATH_TO_YOUR_CATKIN%/src/kukadu</div>
</div><!-- fragment --><p> Alternatively, instead of exporting this value every time, you can also add this line to your <em>.bashrc</em> file.</p>
<h2>Description</h2>
<p>In this example, most lines should look familiar to you. If not, please check out again chapter <a class="el" href="robotpage.html">The robot module</a>. The new part is found in lines 15 - 17. In line 15 a new KOMO instance is created. In lines 16 and 17 this instance is set as the planner and kinematics solver in your <a class="el" href="classkukadu_1_1KukieControlQueue.html" title="Contains an implementation of the control queue interface for robots supporting the IISKukie system...">kukadu::KukieControlQueue</a>. In the current version of kukadu, this theoretically is not required, as KOMO is the standard planner. However, you can set it explitely, which is done in the shown example. Whenever the functions <a class="el" href="classkukadu_1_1ControlQueue.html#ad11059100321b24a1af8ef7de8314353" title="Implements simple point to point movement in joint space (blocks until target reached) ...">kukadu::ControlQueue::jointPtp()</a> and <a class="el" href="classkukadu_1_1ControlQueue.html#a1bfa23a8ce6319f6ef0ed9208e896054" title="Implements simple point to point movement in cartesian space. ">kukadu::ControlQueue::cartesianPtp()</a> are used, the planner that was set in lines 16 and 17 is consulted. The generated plan is executed immediately.</p>
<p>It is also possible to use the planner directly without calling the PtP methods of <a class="el" href="classkukadu_1_1ControlQueue.html" title="Interface between the kukadu software stack and the robot hardware. If kukadu shall support another r...">kukadu::ControlQueue</a>. You find these functions in the API description of <a class="el" href="classkukadu_1_1PathPlanner.html">kukadu::PathPlanner</a>. You can execute the generated plan by using <a class="el" href="classkukadu_1_1ControlQueue.html#a0025c5c010a1b33d637e52fb24f767b2" title="With setNextTrajectory() a complete trajectory can be added to the queue. The trajectory will be exec...">kukadu::ControlQueue::setNextTrajectory()</a>. An example on how this is done is given in the next code snippet.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;kukadu/kukadu.hpp&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;geometry_msgs/Pose.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>kukadu;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up ros node&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ros::init(argc, args, <span class="stringliteral">&quot;kukadu_planning&quot;</span>); ros::NodeHandle node; sleep(1);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ros::AsyncSpinner spinner(10); spinner.start();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up control queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">auto</span> realLeftQueue = make_shared&lt;KukieControlQueue&gt;(<span class="stringliteral">&quot;simulation&quot;</span>, <span class="stringliteral">&quot;left_arm&quot;</span>, node);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;starting queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keyword">auto</span> realLqThread = realLeftQueue-&gt;startQueue();</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;switching to impedance mode if it is not there yet&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">if</span>(realLeftQueue-&gt;getCurrentMode() != KukieControlQueue::KUKA_JNT_IMP_MODE) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        realLeftQueue-&gt;switchMode(KukieControlQueue::KUKA_JNT_IMP_MODE);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="classkukadu_1_1KomoPlanner.html">KomoPlanner</a> leftSimKomoPlanner(realLeftQueue, resolvePath(<span class="stringliteral">&quot;$KUKADU_HOME/external/komo/share/data/kuka/data/iis_robot.kvg&quot;</span>), resolvePath(<span class="stringliteral">&quot;$KUKADU_HOME/external/komo/share/data/kuka/config/MT.cfg&quot;</span>), <span class="stringliteral">&quot;left&quot;</span>);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">/****** stuff is set up now --&gt; here you can move as much as you want *******/</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// this places the robot somewhere</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;joint ptp&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    realLeftQueue-&gt;jointPtp({-1.5, 1.56, 2.33, -1.74, -1.85, 1.27, 0.71});</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// some cartesian position from which the trajectory should be started</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp without max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    geometry_msgs::Pose nextPose; nextPose.position.x = 0.21; nextPose.position.y = 1.3; nextPose.position.z = 0.6;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    nextPose.orientation.x = -0.06; nextPose.orientation.y = -0.14; nextPose.orientation.z = -0.29; nextPose.orientation.w = 0.94;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// creating the cartesian trajectory with some intermediate steps the robot should pass through</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;planning in z direction&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">auto</span> stepSize = 0.01;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    vector&lt;geometry_msgs::Pose&gt; cartesianTrajectory;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">double</span> i = 0.0; i &lt; 0.1; i += stepSize) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        nextPose.position.z -= stepSize;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        cartesianTrajectory.push_back(nextPose);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;planning in x direction&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">double</span> i = 0.0; i &lt; 0.1; i += 0.01) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        nextPose.position.y -= stepSize;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        cartesianTrajectory.push_back(nextPose);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// after creating the trajectory, the planner can plan the trajectory and returns a joint trajectory</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// corresponding to the cartesian path</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;planning&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// argument 1: cartesian trajectory (with the intermediate poses of the endeffector)</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// argument 2: whether or not the joint trajectory should be smoothed a bit or not (smoothing not perfect yet)</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// argument 3: whether or not considering the current pose of the robot --&gt; will first move from the current</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// state to the first pose in the cartesian trajectory (if you set this to false, you should be sure</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// about what you are doing)</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">auto</span> jointPlan = leftSimKomoPlanner.planCartesianTrajectory(cartesianTrajectory, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// the complete trajectory can be added to the control queue and will be executed</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// as soon as the previously loaded movements are done (in this case no previous movement is in the</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// queue anymore)</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    realLeftQueue-&gt;setNextTrajectory(jointPlan);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    realLeftQueue-&gt;synchronizeToQueue(1);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;execution done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">/****** done with moving? --&gt; clean up everything and quit *******/</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    realLeftQueue-&gt;stopQueue();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    realLqThread-&gt;join();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="ttc" id="classkukadu_1_1KomoPlanner_html"><div class="ttname"><a href="classkukadu_1_1KomoPlanner.html">kukadu::KomoPlanner</a></div><div class="ttdef"><b>Definition:</b> komoplanner.hpp:50</div></div>
</div><!-- fragment --><h1><a class="el" href="classkukadu_1_1MoveItKinematics.html">kukadu::MoveItKinematics</a></h1>
<p>MoveIt is one of the standard ways in the ROS universe for robot control and path planning. kukadu also provides an interface to this framework.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;kukadu/kukadu.hpp&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;geometry_msgs/Pose.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>kukadu;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up ros node&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ros::init(argc, args, <span class="stringliteral">&quot;kukadu_planning&quot;</span>); ros::NodeHandle node; sleep(1);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ros::AsyncSpinner spinner(10); spinner.start();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up control queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">auto</span> realLeftQueue = make_shared&lt;KukieControlQueue&gt;(<span class="stringliteral">&quot;simulation&quot;</span>, <span class="stringliteral">&quot;left_arm&quot;</span>, node);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keyword">auto</span> moveit = make_shared&lt;MoveItKinematics&gt;(realLeftQueue, node, <span class="stringliteral">&quot;left_arm&quot;</span>,</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            vector&lt;string&gt;({<span class="stringliteral">&quot;left_arm_0_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_1_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_2_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_3_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_4_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_5_joint&quot;</span>, <span class="stringliteral">&quot;left_arm_6_joint&quot;</span>}),</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            <span class="stringliteral">&quot;left_arm_7_link&quot;</span>);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    realLeftQueue-&gt;setPathPlanner(moveit);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    realLeftQueue-&gt;setKinematics(moveit);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;starting queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keyword">auto</span> realLqThread = realLeftQueue-&gt;startQueue();</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;switching to impedance mode if it is not there yet&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span>(realLeftQueue-&gt;getCurrentMode() != KukieControlQueue::KUKA_JNT_IMP_MODE) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        realLeftQueue-&gt;switchMode(KukieControlQueue::KUKA_JNT_IMP_MODE);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    }</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">/****** stuff is set up now --&gt; here you can move as much as you want *******/</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;joint ptp&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    realLeftQueue-&gt;jointPtp({-1.5, 1.56, 2.33, -1.74, -1.85, 1.27, 0.71});</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp without max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    geometry_msgs::Pose nextPose; nextPose.position.x = 0.3; nextPose.position.y = 1.3; nextPose.position.z = 0.6;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    nextPose.orientation.x = -0.06; nextPose.orientation.y = -0.14; nextPose.orientation.z = -0.29; nextPose.orientation.w = 0.94;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;first ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp with max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    nextPose.position.z = 0.45;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose, 10.0);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;second ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">/****** done with moving? --&gt; clean up everything and quit *******/</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    realLeftQueue-&gt;stopQueue();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    realLqThread-&gt;join();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
</div><!-- fragment --><h2>Prerequisites</h2>
<p>In order to use kukadu with MoveIt, you need to upload the robot model and the MoveIt configuration to the parameter server. Typically, this can be done by using the launch files generated by the MoveIt configuration setup. You might execute something similar to </p>
<div class="fragment"><div class="line">roslaunch uibk_robot_moveit_config demo.launch</div>
</div><!-- fragment --><p> If you are not familiar with MoveIt, please consult the <a href="http://moveit.ros.org/documentation/tutorials/">MoveIt tutorial</a> on how to set up MoveIt for your robot.</p>
<h2>Description</h2>
<p>The code is very similar to the one that was described for the KOMO planner. As both planners (MoveIt and KOMO) implement the same kukadu interface (<a class="el" href="classkukadu_1_1PathPlanner.html">kukadu::PathPlanner</a>), the only difference is found in line 15, where you create a <a class="el" href="classkukadu_1_1MoveItKinematics.html">kukadu::MoveItKinematics</a> instance instead of an <a class="el" href="classkukadu_1_1KomoPlanner.html">kukadu::KomoPlanner</a> instance. The rest of the code is independent of the concrete planner.</p>
<h1><a class="el" href="classkukadu_1_1SimplePlanner.html">kukadu::SimplePlanner</a></h1>
<p>TODO: this code is not tested yet</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;kukadu/kukadu.hpp&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;geometry_msgs/Pose.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>kukadu;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up ros node&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ros::init(argc, args, <span class="stringliteral">&quot;kukadu_planning&quot;</span>); ros::NodeHandle node; sleep(1);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ros::AsyncSpinner spinner(10); spinner.start();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;setting up control queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">auto</span> realLeftQueue = make_shared&lt;KukieControlQueue&gt;(<span class="stringliteral">&quot;simulation&quot;</span>, <span class="stringliteral">&quot;left_arm&quot;</span>, node);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keyword">auto</span> simple = make_shared&lt;SimplePlanner&gt;(realLeftQueue, realLeftQueue-&gt;getKinematics());</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    realLeftQueue-&gt;setPathPlanner(simple);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;starting queue&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keyword">auto</span> realLqThread = realLeftQueue-&gt;startQueue();</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;switching to impedance mode if it is not there yet&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span>(realLeftQueue-&gt;getCurrentMode() != KukieControlQueue::KUKA_JNT_IMP_MODE) {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        realLeftQueue-&gt;switchMode(KukieControlQueue::KUKA_JNT_IMP_MODE);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">/****** stuff is set up now --&gt; here you can move as much as you want *******/</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;joint ptp&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    realLeftQueue-&gt;jointPtp({-1.5, 1.56, 2.33, -1.74, -1.85, 1.27, 0.71});</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp without max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    geometry_msgs::Pose nextPose; nextPose.position.x = 0.3; nextPose.position.y = 1.3; nextPose.position.z = 0.6;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    nextPose.orientation.x = -0.06; nextPose.orientation.y = -0.14; nextPose.orientation.z = -0.29; nextPose.orientation.w = 0.94;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;first ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;ptp with max force&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    nextPose.position.z = 0.45;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    realLeftQueue-&gt;cartesianPtp(nextPose, 10.0);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;second ptp done&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">/****** done with moving? --&gt; clean up everything and quit *******/</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    realLeftQueue-&gt;stopCurrentMode();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    realLeftQueue-&gt;stopQueue();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    realLqThread-&gt;join();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
</div><!-- fragment --><h2>Prerequisites</h2>
<p>None</p>
<p>Prev (<a class="el" href="robotpage.html">The robot module</a>), Next (<a class="el" href="controlpage.html">The control module</a>) </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 1 2016 23:18:28 for kukadu by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
